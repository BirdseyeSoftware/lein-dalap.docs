---
title: "Getting Started with lein-dalap"
layout: article
---

## About this guide

This guide explains how to setup lein-dalap in your leiningen project,
specificaly:

* How to specify which files would you like to be translated to
  clojurescript in your project.
* How to use the default transformation rules that come with lein-dalap
* How to define your own transformation rules for each file you want to
  transform to clojurescript
* How to integrate easily with lein-cljsbuild

## What version of lein-dalap this guide covers?

This guide covers lein-dalap version 0.1.0

## Overview

lein-dalap is an _easy to use_ source code transformation tool. It's
main purpose is to allow the programmer to share the same code base
for both Clojure and Clojurescript without to much of a hassle. It
also offers a way to extend the transformation parser by adding custom
rules that adapt to the specific needs of your project. You may see it
as a replacement for [lein-cljsbuild's crossovers][cljsbuild_crossovers].

## Supported Clojure Versions

Currently this tool has only been tested with Clojure 1.4 and leiningen 2

## Adding lein-dalap to your project

You will require leiningen in order to use this plugin, you'll need
to add it to the plugin list of your project

{% gist 4165781 %}

## Executing lein-dalap transformation command

lein-dalap offers a similar interface to lein-cljsbuild, there are
three important sub-task you should be aware of:

* `lein dalap auto` transforms your clj files to cljs files as
   soon as it detects a change in one of them
* `lein dalap once`  transforms your clj files to cljs only once
* `lein dalap clean` removes all files generated by lein-dalap

## Specifying which files you want to transform to cljs

lein-dalap will expect you to specify every Clojure source file that
you would like to transform to Clojurescript, you'll use the
`dalap_rules.clj` for that.

{% gist 4165851 %}

This is a file that needs to be in the root of your project (where
your project.clj is). In here you'll specify a map of file specs with
its specific transformation rules, a file spec is a tuple of
`[input-path output-path]`, and the transformation rules are contained
in a vector of keys and values separated by spaces.

You will need to specify a file-spec for each of the files you want to
transform to cljs, you may leave the transformation rules empty, given
that lein-dalap already offers some by default.

## Transformation rules _baked-in_ in lein-dalap

### JVM Types to Javascript Types

By default lein-dalap offers transformation of some Clojure core
symbols to Clojurescript's, starting with basic Java types like
String, Integer, Long, etc. They all would be replaced by the
equivalent Javascript type.

    (extend-protocol IMyProtocol
      String
      (my-fn [s] ...)

      Object
      (my-fn [s] ...)

This would get translated to the following Clojurescript snippet

    (extend-protocol IMyProtocol
      string
      (my-fn [s] ...)

      default
      (my-fn [s] ...))

### The :cljs meta tag

You may replace an specific form in your Clojure file with one that
would make more sense in Clojurescript by using the `:cljs` key on the
form meta. This allows you to specify to different snippets of code in
valid Clojure syntax.

    ^{:cljs
      '(ns project.test.util-tests
        (:require [project.util :as utils])
        (:require-macros buster-cljs.macros :refer [deftest describe it is]))
    (ns project.test.util-tests
       (:require [buster-cljs.clojure :refer [deftest describe it is]
                 [project.util :as utils])

This will use the form specified on the `:cljs` meta key when transforming
from Clojure to Clojurescript, while keeping valid Clojure code.

### The :clj meta tag

You may remove completely a form from the Clojurescript output file by
adding a `^:clj` meta tag

    (defn my-fn []
      ^:clj
      (println "hello world")
      ...)

The `(println "hello world")` form will not be on the Clojurescript
output after transformation.

### The ignore reader macro with :cljs at the start

You may specify a form that will only be available in Clojurescript while
keeping it a valid Clojure form by using the `#_(:cljs form)` syntax

    #_(:cljs (initialize-buster))

This will be replaced with the following on the Clojurescript output file

    (do
      (initialize-buster))

## Integrating with lein-cljsbuild

Given that you will most likely be running cljsbuild alongside this plugin
you can automatically run lein-dalap when you are running cljsbuild auto or
once command, just by adding a `:hooks` to your `project.clj` file

     (defproject my-project
       ;; ...
       :hooks [leiningen.dalap]
       ;; ...
       )

## Wrapping Up

Congratulations, you now know how to do the most common operations
with lein-dalap, let's review what we just learned:

* Use the `lein dalap auto|once|clean` commands.
* Create a new `dalap_rules.clj` specifying the files you want to transform.
* Specify basic custom transformation rules for specific input files.
* Integrate with lein-cljsbuild.

## What to read next

You may want to check out the [dalap][dalap_url] project in general, and how to use
it to generate HTML templates using the same rule transformation system
we use in lein-dalap.

[cljsbuild_crossovers]: https://github.com/emezeske/lein-cljsbuild/blob/0.2.9/doc/CROSSOVERS.md
[dalap_url]: https://github.com/van-clj/dalap